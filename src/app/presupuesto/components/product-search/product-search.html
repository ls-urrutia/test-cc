<div class="search-table-wrapper" tabindex="0" aria-label="Buscador de productos">
  <!-- Barra de b√∫squeda -->
  <form (submit)="onSearch(); $event.preventDefault()" style="margin-bottom:1rem; display:flex; gap:.5rem;">
    <input type="text" [(ngModel)]="term" name="term" placeholder="üîç Busca por nombre, SKU o descripci√≥n..." autofocus aria-label="Buscar producto" list="sugerencias"/>
    <datalist id="sugerencias">
      <option *ngFor="let p of results.slice(0,10)" [value]="p.sku + ' - ' + p.name"></option>
    </datalist>
    <button type="submit" [disabled]="loading" aria-label="Buscar">Buscar</button>
    <!-- Filtros r√°pidos -->
    <select [(ngModel)]="filterMarca" name="marca" (change)="onSearch()" aria-label="Filtrar por marca">
      <option value="">Todas las marcas</option>
      <option *ngFor="let m of marcas">{{m}}</option>
    </select>
    <input type="number" [(ngModel)]="filterPrecio" name="precio" (change)="onSearch()" placeholder="Precio m√°x." min="0" aria-label="Filtrar por precio m√°ximo" style="width:7em"/>
  </form>
  <div *ngIf="loading" class="search-loading" aria-live="polite">Buscando productos...</div>
  <div *ngIf="!loading && !term && results.length" class="search-hint">
    Escribe para filtrar productos o explora el cat√°logo completo.
  </div>
  <table class="search-table" aria-label="Resultados de productos">
    <thead>
      <tr>
        <th>SKU</th>
        <th>Nombre</th>
        <th>Descripci√≥n</th>
        <th>Precio de Venta</th>
        <th>Marca</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of pagedResults" (click)="onSelect(p)" class="search-row" [class.selected]="p===selected" tabindex="0"
          [attr.aria-label]="'Seleccionar producto ' + p.name"
          [attr.title]="p.description">
        <td>{{ p.sku }}</td>
        <td>{{ p.name }}</td>
        <td>{{ p.description }}</td>
        <td>{{ p.price | currency:'CLP' }}</td>
        <td>{{ p.brand }}</td>
      </tr>
      <tr *ngIf="!results.length && !loading">
        <td colspan="5" class="empty">
          No se encontraron productos.
        </td>
      </tr>
    </tbody>
  </table>
  <div class="search-table-footer">
    <div class="per-page">
      Items por p√°gina:
      <select [(ngModel)]="pageSize" aria-label="Items por p√°gina">
        <option *ngFor="let n of [5,10,20]">{{ n }}</option>
      </select>
    </div>
    <div class="pagination">
      {{ (page * pageSize) + 1 }} ‚Äì
      {{ Math.min((page+1)*pageSize, results.length) }}  
      de {{ results.length }}
      <button (click)="prev()" [disabled]="page===0" aria-label="P√°gina anterior">‚Äπ</button>
      <button (click)="next()" [disabled]="(page+1)*pageSize>=results.length" aria-label="P√°gina siguiente">‚Ä∫</button>
    </div>
  </div>
</div>
